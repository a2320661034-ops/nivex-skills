# 质量标准 — 验证门禁与列完整性保护

## 核心铁律

**只修改目标语言列，绝不触碰其他任何列。**

违反此规则 = 数据污染 = 全部回滚。

---

## 备份要求

- 修改前必须创建备份：`{原文件名}_backup_原始.csv`
- 备份已存在则跳过（不覆盖历史备份）
- 备份文件与原文件同目录
- 交付后备份保留，不删除

---

## 列完整性验证（每次修改后必须执行）

### V1: 行数验证
- 修改后行数 == 备份行数
- 失败 → 阻断交付，回滚到备份

### V2: 列数验证
- 修改后列数 == 备份列数
- 失败 → 阻断交付，回滚到备份

### V3: 非目标列一致性
- 对比修改前后，除目标语言列外的**所有列**必须逐字节一致
- 全量方法：逐行对比所有非目标列
- 快速方法：随机抽取 ≥ 20行，对比所有非目标列
- 任一列不一致 → 阻断交付，定位污染行

### V4: 编号ID完整性
- 修改前后编号ID列完全一致（顺序和值）
- 失败 → 阻断交付

---

## 6道质量门禁（交付前必须全部通过）

| 门禁 | 检查项 | 通过标准 | 允许例外 |
|------|--------|---------|---------|
| Gate 1 | 零致命问题 | 重新扫描P0问题类型，数量=0 | 源语言本身为空/纯符号/纯英文的行 |
| Gate 2 | 零全角标点 | 重新扫描全角标点，数量=0 | 无 |
| Gate 3 | 零中文残留 | 重新扫描中文字符，数量=0 | 无 |
| Gate 4 | 零编码损坏 | 重新扫描mojibake模式，数量=0 | 无 |
| Gate 5 | 术语一致性 | 术语标准条目全部匹配 | 长文本中术语语境不同的情况 |
| Gate 6 | 行列不变 | 行数/列数/非目标列全部一致 | 无 |

---

## 验证流程

```
1. 读取修改后的CSV文件
2. 读取备份文件
3. 执行 V1-V4 列完整性验证
4. 对修改后文件执行全量扫描（同 Step 1）
5. 检查 Gate 1-6
6. 生成验证报告（按 模板/验证报告格式.md）
```

---

## 交付判定

### SAFE TO DEPLOY
- 6道门禁全部 PASS
- 列完整性验证 V1-V4 全部 PASS
- 龙老师覆盖术语已全部应用
- 备份文件存在且可回滚

### NOT SAFE TO DEPLOY
- 任一门禁 FAIL
- 列出所有剩余问题
- 回到修正步骤处理后重新验证

---

## 迭代规则

- 修正 → 验证可以多轮迭代（Step 4 ↔ Step 5）
- **每轮迭代问题数必须递减**
- 如果不减反增 → 停下来，检查修复逻辑是否引入新问题
- 通常2-3轮迭代即可达到零问题

---

## CSV写入规范

修改后写回CSV时，必须遵守：
- 编码：`utf-8-sig`（带BOM）
- 换行：`newline=''`
- 引用：`csv.QUOTE_MINIMAL`（与原文件一致）
- 字段顺序：与原文件完全一致
- 不新增/不删除/不重排任何列
